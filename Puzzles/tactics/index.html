<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open Chess - Tactique</title>
    <link rel="icon" href="/img/logo.png" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
      integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="../../css/nav.css" />
    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="stylesheet" href="../../css/media.css" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <nav>
        <ul class="sidebar">
          <li class="close-btn" onclick="hidesidebar()">
            <a href="#"><img src="/img/close.svg" alt="close" /></a>
          </li>
          <li class="sidebar-logo"><span>MENU</span></li>
          <li><a href="/Play/index.html">Play</a></li>
          <li><a href="/Puzzles/index.html">Puzzles</a></li>
          <li><a href="/Analyze/index.html">Analyze</a></li>
          <li><a href="/Learn/index.html">Learn</a></li>
        </ul>
        <ul>
          <li class="logo-container">
            <a href="/index.html" style="text-decoration: none">
              <h1 id="site-name">Open Chess</h1>
            </a>
          </li>
          <li class="hideOnMobile">
            <a href="/Play/index.html">Play <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Puzzles/index.html">Puzzles <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Analyze/index.html">Analyze <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Learn/index.html">Learn <span></span></a>
          </li>
          <li class="menu-button" onclick="showsidebar()">
            <a href="#"><img src="/img/menu.svg" alt="menu" /></a>
          </li>
        </ul>
      </nav>
    </header>

    <main class="game-main">
      <div class="game-area">
        <div class="board-wrapper">
          <div id="board" class="board-container"></div>

          <div class="player-info">
            <div id="user-avatar" class="avatar"></div>

            <div class="details">
              <span id="user-name" class="name">Chargement...</span>
              <span class="rating">1200 Elo</span>
            </div>
          </div>
        </div>

        <div class="game-sidebar">
          <div class="sidebar-filters">
            <button class="filter-btn active" onclick="setCategory('all')">
              ‚ôæÔ∏è Tout
            </button>
            <button class="filter-btn" onclick="setCategory('mat')">
              üéØ Mat
            </button>
            <button class="filter-btn" onclick="setCategory('material')">
              üíé Mat√©riel
            </button>
            <button class="filter-btn" onclick="setCategory('position')">
              üè∞ Position
            </button>
            <button class="filter-btn" onclick="setCategory('defense')">
              üõ°Ô∏è D√©fense
            </button>
          </div>

          <div
            class="puzzle-info"
            style="text-align: center; margin-bottom: 1rem"
          >
            <div class="rating-badge">Difficult√©: Moyen</div>
          </div>

          <div class="turn-indicator white-turn">
            <div class="turn-icon"></div>
            <h3 id="status-text">Trait aux Blancs</h3>
            <p>Trouve le meilleur coup !</p>
          </div>

          <div id="feedback-area" class="feedback"></div>

          <div class="controls">
            <div class="hint-wrapper" style="position: relative; width: 100%">
              <div id="hint-bubble" class="hint-tooltip">
                üí° Indice : Regarde les √©checs possibles !
              </div>
              <button id="btn-hint" class="btn-game secondary">
                üí° Indice
              </button>
            </div>

            <button
              id="btn-retry"
              class="btn-game secondary"
              onclick="retryLastMove()"
            >
              üîÑ R√©essayer
            </button>
            <button id="btn-next" class="btn-game primary">Suivant ‚û°</button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-content">
        <div class="footer-section">
          <h3>Open Chess</h3>
          <p>La plateforme ultime pour ma√Ætriser le jeu des rois.</p>
        </div>
        <div class="footer-section">
          <h3>Commencez l'aventure</h3>
          <a href="/login/index.html" class="btn-register"
            >S'inscrire Gratuitement</a
          >
        </div>
        <div class="footer-section">
          <h3>Liens Partenaires</h3>
          <ul>
            <li>
              <a href="https://www.chess.com" target="_blank">Chess.com</a>
            </li>
            <li><a href="#">Cha√Æne YouTube</a></li>
            <li><a href="/support/index.html">Support</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>
          &copy; <span id="year">2026</span> <span>Open Chess</span>. Tous
          droits r√©serv√©s.
        </p>
      </div>
    </footer>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"
      integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script src="data.js"></script>
    <script src="game.js"></script>

    <script type="module">
      // 1. IMPORTS (Toujours tout en haut)
      import { auth, db } from "../../js/auth.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // 2. LOGIQUE FIREBASE
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          console.log("Utilisateur connect√© :", user.uid); // Pour le debug

          const docRef = doc(db, "users", user.uid);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            // CAS 1 : TOUT VA BIEN, LE PROFIL EXISTE
            const data = docSnap.data();
            const pseudo = data.pseudo || "Sans Nom";

            const nameElement = document.getElementById("user-name");
            if (nameElement) nameElement.textContent = pseudo;

            const avatarUrl = `https://api.dicebear.com/9.x/adventurer/svg?seed=${pseudo}`;
            const avatarElement = document.getElementById("user-avatar");
            if (avatarElement) {
              avatarElement.innerHTML = `<img src="${avatarUrl}" alt="Avatar">`;
            }
          } else {
            // CAS 2 : LE COMPTE EXISTE MAIS PAS LES DONN√âES (Ton cas actuel)
            console.log("Aucun document trouv√© dans Firestore !");
            document.getElementById("user-name").textContent = "Profil Vide";

            // On met un avatar par d√©faut
            document.getElementById("user-avatar").innerHTML = `‚ùì`;
          }
        } else {
          window.location.href = "/login/index.html";
        }
      });

      // 3. LOGIQUE DU MENU (La Sidebar)
      // On l'attache √† 'window' pour que les boutons HTML (onclick) puissent les voir
      window.showsidebar = function () {
        const sidebar = document.querySelector(".sidebar");
        sidebar.style.display = "flex";
        setTimeout(() => {
          sidebar.classList.add("active");
        }, 10);
      };

      window.hidesidebar = function () {
        const sidebar = document.querySelector(".sidebar");
        sidebar.classList.remove("active");
        setTimeout(() => {
          sidebar.style.display = "none";
        }, 300);
      };

      // 4. DATE DU FOOTER
      const yearSpan = document.getElementById("year");
      if (yearSpan) yearSpan.textContent = new Date().getFullYear();
      // 5. GESTION DES CAT√âGORIES (Mise √† jour du titre)
    </script>
  </body>
</html>
