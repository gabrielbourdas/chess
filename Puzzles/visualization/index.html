<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open Chess - Visualisation</title>
    <link rel="icon" href="/img/logo.png" type="image/x-icon" />

    <link rel="stylesheet" href="../../css/nav.css" />
    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="stylesheet" href="../../css/media.css" />

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <header>
      <nav>
        <ul class="sidebar">
          <li class="close-btn" onclick="hidesidebar()">
            <a href="#"><img src="/img/close.svg" alt="close" /></a>
          </li>
          <li class="sidebar-logo"><span>MENU</span></li>
          <li><a href="/Play/index.html">Play</a></li>
          <li><a href="/Puzzles/index.html">Puzzles</a></li>
          <li><a href="/Analyze/index.html">Analyze</a></li>
          <li><a href="/Learn/index.html">Learn</a></li>
        </ul>

        <ul>
          <li class="logo-container">
            <a href="/index.html" style="text-decoration: none">
              <h1 id="site-name">Open Chess</h1>
            </a>
          </li>

          <li class="hideOnMobile">
            <a href="/Play/index.html">Play <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Puzzles/index.html">Puzzles <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Analyze/index.html">Analyze <span></span></a>
          </li>
          <li class="hideOnMobile">
            <a href="/Learn/index.html">Learn <span></span></a>
          </li>

          <li class="menu-button" onclick="showsidebar()">
            <a href="#"><img src="/img/menu.svg" alt="menu" /></a>
          </li>
        </ul>
      </nav>
    </header>

    <main class="game-main">
      <div class="filter-bar">
        <button class="filter-btn active" onclick="setCategory('all')">
          â™¾ï¸ Tout
        </button>
        <button class="filter-btn" onclick="setCategory('mat')">ğŸ¯ Mat</button>
        <button class="filter-btn" onclick="setCategory('material')">
          ğŸ’ MatÃ©riel
        </button>
        <button class="filter-btn" onclick="setCategory('position')">
          ğŸ° Position
        </button>
        <button class="filter-btn" onclick="setCategory('defense')">
          ğŸ›¡ï¸ DÃ©fense
        </button>
      </div>
      <div class="game-area">
        <div class="board-wrapper">
          <div id="board" class="board-placeholder visualization-board">
            <span>VISUALISATION<br />(Ne touchez pas les piÃ¨ces !)</span>
          </div>

          <div class="player-info">
            <div id="user-avatar" class="avatar"></div>
            <div class="details">
              <span id="user-name" class="name">Chargement...</span>
              <span class="rating">1200 Elo</span>
            </div>
          </div>
        </div>

        <div class="game-sidebar">
          <div class="puzzle-header">
            <h2><span id="category-title">MÃ©lange</span></h2>
            <div class="rating-badge">Difficile</div>
          </div>

          <div class="turn-indicator white-turn">
            <div class="turn-icon"></div>
            <h3 id="status-text">Trait aux Blancs</h3>
            <p>Calcule la variante gagnante.</p>
          </div>

          <div class="move-input-zone">
            <label for="move-input">Votre solution :</label>
            <div class="input-wrapper">
              <input
                type="text"
                id="move-input"
                placeholder="ex: Cf3, e4..."
                autocomplete="off"
              />
              <button
                class="btn-submit"
                onclick="alert('VÃ©rification en cours...')"
              >
                â¤
              </button>
            </div>
            <p class="input-hint">
              Notation algÃ©brique (Cavaliers = C, Fous = F...)
            </p>
          </div>

          <div id="feedback-area" class="feedback hidden">
            <span class="icon">ğŸ¤”</span> Calcul en cours...
          </div>

          <div class="controls">
            <button
              class="btn-game secondary"
              onclick="alert('Abandon ? La rÃ©ponse Ã©tait Dh5#')"
            >
              ğŸ³ï¸ Abandonner
            </button>
            <button
              class="btn-game secondary"
              onclick="window.location.reload()"
            >
              ğŸ”„ Passer
            </button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-bottom">
        <p>&copy; <span id="year">2026</span> Open Chess.</p>
      </div>
    </footer>

    <script type="module">
      import { auth, db } from "../../js/auth.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const docRef = doc(db, "users", user.uid);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            const pseudo = data.pseudo || "Joueur";

            const nameEl = document.getElementById("user-name");
            if (nameEl) nameEl.textContent = pseudo;

            const avatarUrl = `https://api.dicebear.com/9.x/adventurer/svg?seed=${pseudo}`;
            const avatarEl = document.getElementById("user-avatar");
            if (avatarEl)
              avatarEl.innerHTML = `<img src="${avatarUrl}" alt="Avatar">`;
          } else {
            document.getElementById("user-name").textContent = "Profil Vide";
            document.getElementById("user-avatar").innerHTML = `â“`;
          }
        } else {
          window.location.href = "/login/index.html";
        }
      });

      window.showsidebar = function () {
        const sidebar = document.querySelector(".sidebar");
        sidebar.style.display = "flex";
        setTimeout(() => {
          sidebar.classList.add("active");
        }, 10);
      };

      window.hidesidebar = function () {
        const sidebar = document.querySelector(".sidebar");
        sidebar.classList.remove("active");
        setTimeout(() => {
          sidebar.style.display = "none";
        }, 300);
      };

      const yearSpan = document.getElementById("year");
      if (yearSpan) yearSpan.textContent = new Date().getFullYear();
      // 5. GESTION DES CATÃ‰GORIES (Mise Ã  jour du titre)
      window.setCategory = function (cat) {
        // A. Gestion des boutons (Active/Inactive)
        document
          .querySelectorAll(".filter-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // B. Dictionnaire des noms pour l'affichage
        const names = {
          all: "â™¾ï¸ MÃ©lange",
          mat: "ğŸ¯ Mat",
          material: "ğŸ’ MatÃ©riel",
          position: "ğŸ° Position",
          defense: "ğŸ›¡ï¸ DÃ©fense",
        };

        // C. Mise Ã  jour du texte
        document.getElementById("category-title").textContent = names[cat];

        // (Ici on ajoutera plus tard la logique pour charger un nouveau puzzle)
        console.log("CatÃ©gorie changÃ©e pour : " + cat);
      };
    </script>
  </body>
</html>
