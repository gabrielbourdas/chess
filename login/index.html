<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open Chess | Identification</title>
    <link rel="icon" href="/img/logo.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/nav.css" />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <a href="../index.html" class="logo"
          >OPEN CHESS<span class="dot">.</span></a
        >

        <ul class="nav-links">
          <li><a href="../Play/index.html">Jouer</a></li>
          <li><a href="../Puzzles/index.html">D√©fis</a></li>
          <li><a href="../Learn/index.html">Apprendre</a></li>
          <li><a href="../Analyze/index.html">Analyser</a></li>
        </ul>

        <div class="nav-actions">
          <a href="#" class="btn-login" style="color: var(--accent-gold)"
            >Connexion</a
          >
        </div>

        <div class="hamburger" onclick="toggleMenu()">
          <span></span><span></span>
        </div>
      </nav>

      <div class="mobile-menu" id="mobileMenu">
        <a href="../Play/index.html">Jouer</a>
        <a href="../Puzzles/index.html">D√©fis</a>
        <a href="../Learn/index.html">Apprendre</a>
        <a href="../Analyze/index.html">Analyser</a>
      </div>
    </header>

    <main class="auth-main">
      <div class="auth-wrapper">
        <div id="login-box" class="auth-card fade-in">
          <div class="auth-header">
            <div class="auth-icon">üóùÔ∏è</div>
            <h2>Espace Membre</h2>
            <p>Veuillez vous identifier pour acc√©der √† l'√©chiquier.</p>
          </div>

          <form action="#" class="auth-form">
            <div class="input-group">
              <label for="login-user">Adresse Email</label>
              <input
                type="text"
                id="login-user"
                placeholder="exemple@email.com"
                required
              />
            </div>
            <div class="input-group">
              <label for="login-pass">Mot de passe</label>
              <input
                type="password"
                id="login-pass"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                required
              />
            </div>

            <div class="form-options">
              <label class="checkbox-container">
                <input type="checkbox" checked />
                <span class="checkmark"></span> Se souvenir
              </label>
              <a href="#" class="forgot-pass">Mot de passe oubli√© ?</a>
            </div>

            <button type="submit" class="btn-primary full-width">
              Connexion
            </button>
          </form>

          <div class="auth-footer">
            <p>
              Premi√®re visite ?
              <a href="#" onclick="switchForm('register')">Cr√©er un compte</a>
            </p>
          </div>
        </div>

        <div id="register-box" class="auth-card hidden fade-in">
          <div class="auth-header">
            <div class="auth-icon">‚ôüÔ∏è</div>
            <h2>Nouveau Joueur</h2>
            <p>Rejoignez le cercle et suivez votre progression.</p>
          </div>

          <form action="#" class="auth-form">
            <div class="input-group">
              <label for="reg-user">Pseudo</label>
              <input
                type="text"
                id="reg-user"
                placeholder="Votre nom de joueur"
                required
              />
            </div>

            <div class="input-group">
              <label for="reg-email">Email</label>
              <input
                type="email"
                id="reg-email"
                placeholder="Pour la r√©cup√©ration du compte"
              />
            </div>

            <div class="input-group">
              <label for="reg-pass">Mot de passe</label>
              <input
                type="password"
                id="reg-pass"
                placeholder="6 caract√®res minimum"
                required
              />
            </div>

            <div class="input-group">
              <label for="reg-pass-conf">Confirmation</label>
              <input
                type="password"
                id="reg-pass-conf"
                placeholder="Confirmez le mot de passe"
                required
              />
            </div>

            <button type="submit" class="btn-primary full-width">
              Finaliser l'inscription
            </button>
          </form>

          <div class="auth-footer">
            <p>
              D√©j√† membre ?
              <a href="#" onclick="switchForm('login')">Se connecter</a>
            </p>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-inner">
        <div class="footer-brand">
          <h4>Open Chess<span class="dot">.</span></h4>
          <p>L'excellence strat√©gique √† port√©e de main.</p>
        </div>
        <div class="footer-nav-group">
          <div class="footer-col">
            <h5>Navigation</h5>
            <ul>
              <li><a href="../Play/index.html">Jouer</a></li>
              <li><a href="../Puzzles/index.html">Puzzles</a></li>
              <li><a href="../Learn/index.html">Apprendre</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h5>Support</h5>
            <ul>
              <li><a href="../support/index.html">Contact</a></li>
              <li><a href="../rules/index.html">R√®gles</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-copy">
          &copy; <span id="year">2026</span> Open Chess.
        </div>
      </div>
    </footer>

    <script type="module">
      // 1. IMPORT DU CERVEAU (Ajuste si ton fichier est bien dans /js/auth.js √† la racine)
      import { auth, db } from "../js/auth.js";

      // 2. IMPORT DES OUTILS FIREBASE
      import {
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        sendPasswordResetEmail,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      import {
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // --- LOGIQUE D'INSCRIPTION ---
      const registerForm = document.querySelector("#register-box form");
      if (registerForm) {
        registerForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const email = document.getElementById("reg-email").value;
          const password = document.getElementById("reg-pass").value;
          const pseudo = document.getElementById("reg-user").value;
          const passConf = document.getElementById("reg-pass-conf").value;

          if (password !== passConf) {
            alert("Les mots de passe ne correspondent pas !");
            return;
          }

          createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
              const user = userCredential.user;
              return setDoc(doc(db, "users", user.uid), {
                pseudo: pseudo,
                email: email,
                progress: { opening: 0, puzzles: 0 },
                currentPuzzleElo: 1200, // Initialisation Stats
                puzzlesSolved: 0,
                currentVisuElo: 1000,
              });
            })
            .then(() => {
              alert("Bienvenue, " + pseudo + ". Votre compte est pr√™t.");
              window.location.href = "../index.html";
            })
            .catch((error) => {
              let msg = "Erreur : " + error.message;
              if (error.code === "auth/email-already-in-use")
                msg = "Cet email est d√©j√† inscrit.";
              if (error.code === "auth/weak-password")
                msg = "Mot de passe trop faible.";
              alert(msg);
            });
        });
      }

      // --- LOGIQUE DE CONNEXION ---
      const loginForm = document.querySelector("#login-box form");
      if (loginForm) {
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const email = document.getElementById("login-user").value;
          const password = document.getElementById("login-pass").value;

          signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
              console.log("Acc√®s autoris√©.");
              window.location.href = "../index.html";
            })
            .catch((error) => {
              console.error(error);
              alert("Identifiants incorrects.");
            });
        });
      }

      // --- MOT DE PASSE OUBLI√â ---
      const forgotBtn = document.querySelector(".forgot-pass");
      if (forgotBtn) {
        forgotBtn.addEventListener("click", (e) => {
          e.preventDefault();
          let email = document.getElementById("login-user").value;
          if (!email) {
            email = prompt(
              "Veuillez entrer votre email pour r√©initialiser le mot de passe :",
            );
          }
          if (!email) return;

          sendPasswordResetEmail(auth, email)
            .then(() => {
              alert("Un email de r√©initialisation a √©t√© envoy√©.");
            })
            .catch((error) => {
              alert("Erreur : " + error.message);
            });
        });
      }

      // --- FONCTIONS UI (Menu & Switch Form) ---
      window.toggleMenu = function () {
        document.getElementById("mobileMenu").classList.toggle("active");
        document.querySelector(".hamburger").classList.toggle("active");
      };

      window.switchForm = function (target) {
        const loginBox = document.getElementById("login-box");
        const registerBox = document.getElementById("register-box");

        // Reset des animations pour qu'elles se rejouent
        loginBox.classList.remove("fade-in");
        registerBox.classList.remove("fade-in");
        void loginBox.offsetWidth; // Trigger reflow

        if (target === "register") {
          loginBox.classList.add("hidden");
          registerBox.classList.remove("hidden");
          registerBox.classList.add("fade-in");
        } else {
          registerBox.classList.add("hidden");
          loginBox.classList.remove("hidden");
          loginBox.classList.add("fade-in");
        }
      };

      document.getElementById("year").textContent = new Date().getFullYear();
    </script>
  </body>
</html>
