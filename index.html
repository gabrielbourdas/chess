<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mon Espace Échecs | Accueil</title>
    <link rel="icon" href="/img/logo.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/nav.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <a href="/" class="logo">OPEN CHESS<span class="dot">.</span></a>
        <ul class="nav-links">
          <li><a href="/Play/index.html">Jouer</a></li>
          <li><a href="/Puzzles/index.html">Défis</a></li>
          <li><a href="/Learn/index.html">Apprendre</a></li>
          <li><a href="/Analyze/index.html">Analyser</a></li>
        </ul>
        <div class="nav-actions">
          <a href="/login/index.html" class="btn-login" id="nav-login-btn"
            >Connexion</a
          >
          <a href="/Play/index.html" class="btn-primary small"
            >Lancer un défi</a
          >
        </div>
        <div class="hamburger" onclick="toggleMenu()">
          <span></span><span></span>
        </div>
      </nav>
      <div class="mobile-menu" id="mobileMenu">
        <a href="/Play/index.html">Jouer</a>
        <a href="/Puzzles/index.html">Défis</a>
        <a href="/Learn/index.html">Apprendre</a>
        <a href="/login/index.html">Connexion</a>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="hero-content">
          <span class="subtitle"
            >Bienvenue <span id="hero-username">Invité</span></span
          >
          <h1>Échecs & <br /><em>Focus.</em></h1>
          <p>
            Bienvenue sur mon échiquier virtuel. Connecte-toi pour suivre ta
            progression et compare tes scores avec les autres.
          </p>
          <div class="cta-group">
            <a href="/Play/index.html" class="btn-primary">Jouer contre l'IA</a>
            <a href="/Puzzles/index.html" class="btn-secondary"
              >Résoudre un puzzle</a
            >
          </div>
        </div>
        <div class="hero-visual"></div>
      </section>

      <div class="personal-stats" id="stats-container">
        <div class="stat-loading" id="stat-loading">
          Connexion aux archives...
        </div>

        <div class="stats-content" id="stats-content" style="display: none">
          <div class="stat-item">
            <span class="label">Elo Tactique</span>
            <span class="value" id="stat-puzzle-elo">1200</span>
          </div>
          <div class="stat-item">
            <span class="label">Puzzles Résolus</span>
            <span class="value" id="stat-puzzles-solved">0</span>
          </div>
          <div class="stat-item">
            <span class="label">Elo Visualisation</span>
            <span class="value" id="stat-visu-elo">1000</span>
          </div>
        </div>
      </div>

      <section class="progression-section">
        <div class="section-header">
          <h2>Votre chemin vers la maîtrise</h2>
          <p class="section-desc">
            Pas sûr de quoi faire ? Voici mes recommandations basées sur votre
            niveau actuel.
          </p>
          <div class="separator"></div>
        </div>

        <div class="progression-table-wrapper">
          <table class="progression-table">
            <thead>
              <tr>
                <th>Votre Niveau (Elo)</th>
                <th>Profil</th>
                <th>Objectif du jour</th>
                <th>L'outil recommandé</th>
              </tr>
            </thead>
            <tbody>
              <tr class="level-row beginner">
                <td><span class="elo-badge">< 800</span></td>
                <td>Le Débutant Curieux</td>
                <td>
                  Comprendre les mécanismes et éviter de donner des pièces.
                </td>
                <td>
                  <a href="/Learn/index.html" class="table-link"
                    >→ Apprendre les bases</a
                  >
                </td>
              </tr>
              <tr class="level-row intermediate">
                <td><span class="elo-badge">800 - 1200</span></td>
                <td>L'Amateur Éclairé</td>
                <td>Reconnaître les motifs tactiques (Fourchette, Clouage).</td>
                <td>
                  <a href="/Puzzles/index.html" class="table-link"
                    >→ Puzzles Tactiques</a
                  >
                </td>
              </tr>
              <tr class="level-row advanced">
                <td><span class="elo-badge">1200 - 1600</span></td>
                <td>Le Stratège</td>
                <td>
                  Calculer plusieurs coups à l'avance sans voir le plateau.
                </td>
                <td>
                  <a href="/Visualisation/index.html" class="table-link"
                    >→ Entraînement Visu</a
                  >
                </td>
              </tr>
              <tr class="level-row expert">
                <td><span class="elo-badge">1600 +</span></td>
                <td>Le Tueur de Rois</td>
                <td>Jouer contre plus fort et analyser ses erreurs.</td>
                <td>
                  <a href="/Play/bot/index.html" class="table-link"
                    >→ Jouer contre le robot</a
                  >
                  <a href="/Analyze/index.html" class="table-link"
                    >→ Analyser vos parties</a
                  >
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-inner">
        <div class="footer-brand">
          <h4>Open Chess<span class="dot">.</span></h4>
          <p>
            Site développé dans le but d'améliorer les compétences en échecs.
          </p>
        </div>

        <div class="footer-nav-group">
          <div class="footer-col">
            <h5>Le Jeu</h5>
            <ul>
              <li><a href="/Play/index.html">Jouer</a></li>
              <li><a href="/Puzzles/index.html">Puzzles</a></li>
              <li><a href="/Analyze/index.html">Analyse</a></li>
            </ul>
          </div>

          <div class="footer-col">
            <h5>Infos Pratiques</h5>
            <ul>
              <li><a href="/rules/index.html">Règles Simplifiées</a></li>
              <li><a href="/video/index.html">Chaîne YouTube</a></li>
              <li><a href="/support/index.html">Support / Contact</a></li>
            </ul>
          </div>
        </div>

        <div class="footer-copy">
          &copy; <span id="year">2026</span> - Fait maison.
        </div>
      </div>
    </footer>

    <script>
      // Menu Mobile & Date
      document.getElementById("year").textContent = new Date().getFullYear();
      function toggleMenu() {
        document.getElementById("mobileMenu").classList.toggle("active");
        document.querySelector(".hamburger").classList.toggle("active");
      }
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // 1. Même config que tes autres fichiers (Copié depuis ton game.js)
      const firebaseConfig = {
        apiKey: "AIzaSyBNBUO3JupohDCYAMs7Xf6kKgxnnFgPpVM",
        authDomain: "open-chess-2f3cf.firebaseapp.com",
        projectId: "open-chess-2f3cf",
        storageBucket: "open-chess-2f3cf.firebasestorage.app",
        messagingSenderId: "447945730536",
        appId: "1:447945730536:web:a1e3347bc13e94040bdc5d",
        measurementId: "G-71F05DTLHG",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // 2. Écouteur de connexion
      onAuthStateChanged(auth, async (user) => {
        const loadingEl = document.getElementById("stat-loading");
        const contentEl = document.getElementById("stats-content");
        const heroName = document.getElementById("hero-username");
        const navLogin = document.getElementById("nav-login-btn");

        if (user) {
          // --- UTILISATEUR CONNECTÉ ---
          navLogin.textContent = "Mon Compte";
          navLogin.href = "/profile/index.html"; // Lien vers le profil si existant

          try {
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
              const data = docSnap.data();

              // Mise à jour Nom
              heroName.textContent = data.pseudo || "Joueur";

              // Mise à jour Stats (avec valeurs par défaut si undefined)
              // Note: currentPuzzleElo vient de ton game.js
              // Note: currentVisuElo vient de ton logic.js
              animateValue(
                "stat-puzzle-elo",
                0,
                data.currentPuzzleElo || 1200,
                1000,
              );
              animateValue(
                "stat-puzzles-solved",
                0,
                data.puzzlesSolved || 0,
                1000,
              );
              animateValue(
                "stat-visu-elo",
                0,
                data.currentVisuElo || 1000,
                1000,
              );

              loadingEl.style.display = "none";
              contentEl.style.display = "flex";
            } else {
              loadingEl.textContent = "Profil introuvable (Premier login ?)";
            }
          } catch (e) {
            console.error("Erreur récup stats:", e);
            loadingEl.textContent = "Erreur de chargement des stats.";
          }
        } else {
          // --- UTILISATEUR NON CONNECTÉ ---
          heroName.textContent = "l'Ami";
          loadingEl.innerHTML =
            "<a href='/login/index.html' style='color:var(--accent-gold);text-decoration:underline;'>Connectez-vous</a> pour voir vos stats.";
        }
      });

      // Petit effet d'animation pour les chiffres
      function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          obj.innerHTML = Math.floor(progress * (end - start) + start);
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      }
    </script>
  </body>
</html>
